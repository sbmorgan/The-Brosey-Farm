-----------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  clean_01
       log:  C:\Users\sethb\Documents\The Brosey Farm\GitHub repositories\The-Brosey-Farm\analytics\Stata_programs\03_tbf_sales_2023_cleaning.log
  log type:  text
 opened on:  20 Sep 2023, 12:45:18

. 
. 
. *************************************************************************************************
. ***                                                                                           ***
. *** Program name: 03_tbf_sales_2023_cleaning.do                                               ***
. *** Project: TBF Market Garden 2023                                                                       ***
. *** Purpose: Clean TBF Market Garden 2023 sales data                                          ***    
. ***                                                                                                                                                            
>                    ***
. *** Contents:                                                                                             ***
. ***    0) SET UP CODE                                                                                         ***
. ***    I) LOAD RAW DATA                                                                       ***
. ***    II) MANAGE VARIABLES                                                                   ***
. ***    III) CLEAN DATA                                                                        ***
. ***    IV) DESCRIPTIVE STATISTICS                                                             ***
. ***                                                                                           ***
. *** Authors: Seth B. Morgan                                                                               ***
. *** Start date: August 8, 2023                                                                                                    ***
. *** Last date modified: September 19, 2023                                                    ***
. ***                                                                                           ***
. *** Notes:                                                                                    ***
. ***                                                                                           ***
. ***                                                                                           ***
. *************************************************************************************************
. 
. clear all

. version 18.0

. set more off

. set varabbrev off

. pause off

. 
. 
. *=========================================================================================
. * 0) SET UP CODE
. *=========================================================================================      
. 
. /* Set seed */
.         set seed 7122023

.         
. /* Define globals */
. 
.         *Root
.         global root "C:\Users\sethb\Documents\The Brosey Farm\GitHub repositories\The-Brosey-Farm\analytics"

.     adopath ++ "$root"
  [1]              "C:\Users\sethb\Documents\The Brosey Farm\GitHub repositories\The-Brosey-Farm\analytics"
  [2]  (BASE)      "C:\Program Files\Stata18\ado\base/"
  [3]  (SITE)      "C:\Program Files\Stata18\ado\site/"
  [4]              "."
  [5]  (PERSONAL)  "C:\Users\sethb\ado\personal/"
  [6]  (PLUS)      "C:\Users\sethb\ado\plus/"
  [7]  (OLDPLACE)  "c:\ado/"

.     
. 
. *=========================================================================================
. * I) LOAD RAW DATA 
. *=========================================================================================
. 
.         /* Load raw data */
.         import excel "$root\raw_data\Brosey Farming.xlsx", sheet("sales_2023") firstrow clear
(11 vars, 143 obs)

.         keep sale_date-sale_value_usd

.         ds 
sale_date     sale_locat~n  sale_locat~o  sale_locat~c  sale_crop     sale_amnt     sale_unit     sale_value~d

.         
.         /* Save raw TBF Market Garden 2023 data */
.         save "$root\raw_data\tbf_market_garden_sales_2023_raw.dta", replace
file C:\Users\sethb\Documents\The Brosey Farm\GitHub repositories\The-Brosey-Farm\analytics\raw_data\tbf_market_garden_sales_2023_raw.dta saved

.         
.    
. *=========================================================================================
. * II) MANAGE VARIABLES
. *=========================================================================================  
. 
.         /* Add variable labels */
.         label variable sale_date "sale date"

.         label variable sale_location "sale location" 

.         label variable sale_crop "sale crop" 

.         label variable sale_amnt "sale amount" 

.         label variable sale_unit "sale amount unit" 

.         label variable sale_value_usd "sale value (dollars)"

.         
.         /* Manage variable type */
.         describe _all

Variable      Storage   Display    Value
    name         type    format    label      Variable label
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
sale_date       str10   %10s                  sale date
sale_location   str27   %27s                  sale location
sale_location~o byte    %10.0g                sale_location_stall_no
sale_location~c str14   %14s                  sale_location_stall_spec
sale_crop       str29   %29s                  sale crop
sale_amnt       double  %10.0g                sale amount
sale_unit       str5    %9s                   sale amount unit
sale_value_usd  double  %10.0g                sale value (dollars)

.         
.         /* Manage sales date variable */
.         foreach var of varlist *date* {
  2.                 display as input "Variable: `var'"
  3.                 tabulate `var', missing
  4.                 capture confirm string var `var'
  5.                 if _rc!=0 tostring `var', replace
  6.                 generate `var'_year= substr(`var',1,4)
  7.                 generate `var'_month= substr(`var',6,2)
  8.                 generate `var'_day= substr(`var',9,2)
  9.                 foreach var2 of varlist `var'_year `var'_month `var'_day {
 10.                         confirm string var `var2'
 11.                         destring `var2', replace
 12.                 }
 13.                 generate `var'_stata= mdy(`var'_month, `var'_day, `var'_year)
 14.                 drop `var'_year `var'_month `var'_day
 15.                 local varlab : variable label `var'
 16.                 label variable `var'_stata "`varlab'- stata"            
 17.                 format `var'_stata %td
 18.                 order `var'_stata, after(`var')
 19.         }
Variable: sale_date

  sale date |      Freq.     Percent        Cum.
------------+-----------------------------------
 2023-08-05 |         26       18.18       18.18
 2023-08-12 |         18       12.59       30.77
 2023-08-19 |         41       28.67       59.44
 2023-08-26 |         24       16.78       76.22
 2023-08-30 |          1        0.70       76.92
 2023-09-02 |         29       20.28       97.20
 2023-09-07 |          1        0.70       97.90
 2023-09-08 |          1        0.70       98.60
 2023-09-13 |          1        0.70       99.30
 2023-09-14 |          1        0.70      100.00
------------+-----------------------------------
      Total |        143      100.00
sale_date_year: all characters numeric; replaced as int
sale_date_month: all characters numeric; replaced as byte
sale_date_day: all characters numeric; replaced as byte

.         
.         /* Convert categorical strings into categorical numerics */
.         local cat_str_list sale_location sale_crop sale_unit

.         tab1 `cat_str_list', missing

-> tabulation of sale_location  

              sale location |      Freq.     Percent        Cum.
----------------------------+-----------------------------------
New Carlisle Farmers Market |        138       96.50       96.50
The Brosey Farm: farm stand |          5        3.50      100.00
----------------------------+-----------------------------------
                      Total |        143      100.00

-> tabulation of sale_crop  

                    sale crop |      Freq.     Percent        Cum.
------------------------------+-----------------------------------
                              |          5        3.50        3.50
          bean- fin de bagnol |          3        2.10        5.59
              carrot- touchon |         14        9.79       15.38
                     cilantro |          4        2.80       18.18
       eggplant- black beauty |         13        9.09       27.27
              pepper- anaheim |         10        6.99       34.27
      pepper- jalapeno- early |         21       14.69       48.95
         pepper- sweet banana |         11        7.69       56.64
     pepper- sweet- ca wonder |         19       13.29       69.93
            pumpkin- ct field |          1        0.70       70.63
sweet corn- country gentleman |          3        2.10       72.73
                tomato- amish |         27       18.88       91.61
                 tomato- roma |         12        8.39      100.00
------------------------------+-----------------------------------
                        Total |        143      100.00

-> tabulation of sale_unit  

sale amount |
       unit |      Freq.     Percent        Cum.
------------+-----------------------------------
            |          5        3.50        3.50
      bunch |          4        2.80        6.29
      pound |         37       25.87       32.17
       unit |         97       67.83      100.00
------------+-----------------------------------
      Total |        143      100.00

.         foreach var of varlist `cat_str_list' {
  2.                 if `var'=="." continue
  3.                 encode (`var'), generate(`var'_code)
  4.                 tablist `var' `var'_code, sort(variable) ab(32)
  5.                 tablist `var' `var'_code, sort(variable) nolabel ab(32)
  6.                 local varlab : variable label `var'
  7.                 label variable `var'_code "`varlab'- code"
  8.                 order `var'_code, after(`var')
  9.                 *pause
.         }

  +-------------------------------------------------------------------------------------------------+
  |               sale_location            sale_location_code   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |-------------------------------------------------------------------------------------------------|
  | New Carlisle Farmers Market   New Carlisle Farmers Market      138    96.50       138     96.50 |
  | The Brosey Farm: farm stand   The Brosey Farm: farm stand        5     3.50       143    100.00 |
  +-------------------------------------------------------------------------------------------------+

  +----------------------------------------------------------------------------------------+
  |               sale_location   sale_location_code   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |----------------------------------------------------------------------------------------|
  | New Carlisle Farmers Market                    1      138    96.50       138     96.50 |
  | The Brosey Farm: farm stand                    2        5     3.50       143    100.00 |
  +----------------------------------------------------------------------------------------+

  +-----------------------------------------------------------------------------------------------------+
  |                     sale_crop                  sale_crop_code   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |-----------------------------------------------------------------------------------------------------|
  |                 tomato- amish                   tomato- amish       27    18.88        27     18.88 |
  |       pepper- jalapeno- early         pepper- jalapeno- early       21    14.69        48     33.57 |
  |      pepper- sweet- ca wonder        pepper- sweet- ca wonder       19    13.29        67     46.85 |
  |               carrot- touchon                 carrot- touchon       14     9.79        81     56.64 |
  |        eggplant- black beauty          eggplant- black beauty       13     9.09        94     65.73 |
  |-----------------------------------------------------------------------------------------------------|
  |                  tomato- roma                    tomato- roma       12     8.39       106     74.13 |
  |          pepper- sweet banana            pepper- sweet banana       11     7.69       117     81.82 |
  |               pepper- anaheim                 pepper- anaheim       10     6.99       127     88.81 |
  |                                                             .        5     3.50       132     92.31 |
  |                      cilantro                        cilantro        4     2.80       136     95.10 |
  |-----------------------------------------------------------------------------------------------------|
  |           bean- fin de bagnol             bean- fin de bagnol        3     2.10       139     97.20 |
  | sweet corn- country gentleman   sweet corn- country gentleman        3     2.10       142     99.30 |
  |             pumpkin- ct field               pumpkin- ct field        1     0.70       143    100.00 |
  +-----------------------------------------------------------------------------------------------------+

  +--------------------------------------------------------------------------------------+
  |                     sale_crop   sale_crop_code   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |--------------------------------------------------------------------------------------|
  |                 tomato- amish               11       27    18.88        27     18.88 |
  |       pepper- jalapeno- early                6       21    14.69        48     33.57 |
  |      pepper- sweet- ca wonder                8       19    13.29        67     46.85 |
  |               carrot- touchon                2       14     9.79        81     56.64 |
  |        eggplant- black beauty                4       13     9.09        94     65.73 |
  |--------------------------------------------------------------------------------------|
  |                  tomato- roma               12       12     8.39       106     74.13 |
  |          pepper- sweet banana                7       11     7.69       117     81.82 |
  |               pepper- anaheim                5       10     6.99       127     88.81 |
  |                                              .        5     3.50       132     92.31 |
  |                      cilantro                3        4     2.80       136     95.10 |
  |--------------------------------------------------------------------------------------|
  |           bean- fin de bagnol                1        3     2.10       139     97.20 |
  | sweet corn- country gentleman               10        3     2.10       142     99.30 |
  |             pumpkin- ct field                9        1     0.70       143    100.00 |
  +--------------------------------------------------------------------------------------+

  +------------------------------------------------------------------+
  | sale_unit   sale_unit_code   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |------------------------------------------------------------------|
  |      unit             unit       97    67.83        97     67.83 |
  |     pound            pound       37    25.87       134     93.71 |
  |                          .        5     3.50       139     97.20 |
  |     bunch            bunch        4     2.80       143    100.00 |
  +------------------------------------------------------------------+

  +------------------------------------------------------------------+
  | sale_unit   sale_unit_code   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |------------------------------------------------------------------|
  |      unit                3       97    67.83        97     67.83 |
  |     pound                2       37    25.87       134     93.71 |
  |                          .        5     3.50       139     97.20 |
  |     bunch                1        4     2.80       143    100.00 |
  +------------------------------------------------------------------+

. 
.     
. *=========================================================================================
. * III) CLEAN DATA
. *=========================================================================================     
. 
.         /* Clean missing values */
.         foreach var of varlist sale_location_stall_no sale_crop sale_crop_code sale_amnt sale_unit sale_unit_code {
  2.                 capture confirm numeric variable `var'
  3.                 if _rc==0 {
  4.                         assert `var'==. if sale_location== "The Brosey Farm: farm stand"
  5.                         replace `var'=.s if sale_location== "The Brosey Farm: farm stand"
  6.                 }               
  7.                 else {
  8.                         assert `var'=="" if sale_location== "The Brosey Farm: farm stand"
  9.                         replace `var'=".s" if sale_location== "The Brosey Farm: farm stand"                     
 10.                 }
 11.         }
(5 real changes made, 5 to missing)
(5 real changes made)
(5 real changes made, 5 to missing)
(5 real changes made, 5 to missing)
(5 real changes made)
(5 real changes made, 5 to missing)

.         
.         tablist sale_location sale_location_stall_no sale_location_stall_spec, sort(variable) ab(32)

  +-----------------------------------------------------------------------------------------------------------------------+
  |               sale_location   sale_location_stall_no   sale_location_stall_spec   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |-----------------------------------------------------------------------------------------------------------------------|
  | New Carlisle Farmers Market                        5             outside, north       68    47.55        68     47.55 |
  | New Carlisle Farmers Market                        .              outside, east       26    18.18        94     65.73 |
  | New Carlisle Farmers Market                        4             outside, north       26    18.18       120     83.92 |
  | New Carlisle Farmers Market                        8             outside, north       18    12.59       138     96.50 |
  | The Brosey Farm: farm stand                       .s                   roadside        5     3.50       143    100.00 |
  +-----------------------------------------------------------------------------------------------------------------------+

.         replace sale_location_stall_no= .m if sale_location_stall_no==.
(26 real changes made, 26 to missing)

.         replace sale_location_stall_spec= ".m" if sale_location_stall_spec==""
(0 real changes made)

.         
.         foreach var of varlist _all {
  2.                 tabulate `var', missing
  3.                 capture confirm numeric variable `var'
  4.                 if _rc==0 assert `var' !=.
  5.                 else assert `var' !=""
  6.         }       

  sale date |      Freq.     Percent        Cum.
------------+-----------------------------------
 2023-08-05 |         26       18.18       18.18
 2023-08-12 |         18       12.59       30.77
 2023-08-19 |         41       28.67       59.44
 2023-08-26 |         24       16.78       76.22
 2023-08-30 |          1        0.70       76.92
 2023-09-02 |         29       20.28       97.20
 2023-09-07 |          1        0.70       97.90
 2023-09-08 |          1        0.70       98.60
 2023-09-13 |          1        0.70       99.30
 2023-09-14 |          1        0.70      100.00
------------+-----------------------------------
      Total |        143      100.00

 sale date- |
      stata |      Freq.     Percent        Cum.
------------+-----------------------------------
  05aug2023 |         26       18.18       18.18
  12aug2023 |         18       12.59       30.77
  19aug2023 |         41       28.67       59.44
  26aug2023 |         24       16.78       76.22
  30aug2023 |          1        0.70       76.92
  02sep2023 |         29       20.28       97.20
  07sep2023 |          1        0.70       97.90
  08sep2023 |          1        0.70       98.60
  13sep2023 |          1        0.70       99.30
  14sep2023 |          1        0.70      100.00
------------+-----------------------------------
      Total |        143      100.00

              sale location |      Freq.     Percent        Cum.
----------------------------+-----------------------------------
New Carlisle Farmers Market |        138       96.50       96.50
The Brosey Farm: farm stand |          5        3.50      100.00
----------------------------+-----------------------------------
                      Total |        143      100.00

        sale location- code |      Freq.     Percent        Cum.
----------------------------+-----------------------------------
New Carlisle Farmers Market |        138       96.50       96.50
The Brosey Farm: farm stand |          5        3.50      100.00
----------------------------+-----------------------------------
                      Total |        143      100.00

sale_locati |
on_stall_no |      Freq.     Percent        Cum.
------------+-----------------------------------
          4 |         26       18.18       18.18
          5 |         68       47.55       65.73
          8 |         18       12.59       78.32
         .m |         26       18.18       96.50
         .s |          5        3.50      100.00
------------+-----------------------------------
      Total |        143      100.00

sale_location_ |
    stall_spec |      Freq.     Percent        Cum.
---------------+-----------------------------------
 outside, east |         26       18.18       18.18
outside, north |        112       78.32       96.50
      roadside |          5        3.50      100.00
---------------+-----------------------------------
         Total |        143      100.00

                    sale crop |      Freq.     Percent        Cum.
------------------------------+-----------------------------------
                           .s |          5        3.50        3.50
          bean- fin de bagnol |          3        2.10        5.59
              carrot- touchon |         14        9.79       15.38
                     cilantro |          4        2.80       18.18
       eggplant- black beauty |         13        9.09       27.27
              pepper- anaheim |         10        6.99       34.27
      pepper- jalapeno- early |         21       14.69       48.95
         pepper- sweet banana |         11        7.69       56.64
     pepper- sweet- ca wonder |         19       13.29       69.93
            pumpkin- ct field |          1        0.70       70.63
sweet corn- country gentleman |          3        2.10       72.73
                tomato- amish |         27       18.88       91.61
                 tomato- roma |         12        8.39      100.00
------------------------------+-----------------------------------
                        Total |        143      100.00

              sale crop- code |      Freq.     Percent        Cum.
------------------------------+-----------------------------------
          bean- fin de bagnol |          3        2.10        2.10
              carrot- touchon |         14        9.79       11.89
                     cilantro |          4        2.80       14.69
       eggplant- black beauty |         13        9.09       23.78
              pepper- anaheim |         10        6.99       30.77
      pepper- jalapeno- early |         21       14.69       45.45
         pepper- sweet banana |         11        7.69       53.15
     pepper- sweet- ca wonder |         19       13.29       66.43
            pumpkin- ct field |          1        0.70       67.13
sweet corn- country gentleman |          3        2.10       69.23
                tomato- amish |         27       18.88       88.11
                 tomato- roma |         12        8.39       96.50
                           .s |          5        3.50      100.00
------------------------------+-----------------------------------
                        Total |        143      100.00

sale amount |      Freq.     Percent        Cum.
------------+-----------------------------------
         .5 |          5        3.50        3.50
          1 |         42       29.37       32.87
        1.5 |          2        1.40       34.27
          2 |         27       18.88       53.15
        2.5 |          2        1.40       54.55
          3 |         11        7.69       62.24
        3.5 |          1        0.70       62.94
          4 |         16       11.19       74.13
          5 |         12        8.39       82.52
          6 |          6        4.20       86.71
          7 |          2        1.40       88.11
          8 |          4        2.80       90.91
          9 |          2        1.40       92.31
         10 |          2        1.40       93.71
         12 |          1        0.70       94.41
         20 |          1        0.70       95.10
         28 |          1        0.70       95.80
         55 |          1        0.70       96.50
         .s |          5        3.50      100.00
------------+-----------------------------------
      Total |        143      100.00

sale amount |
       unit |      Freq.     Percent        Cum.
------------+-----------------------------------
         .s |          5        3.50        3.50
      bunch |          4        2.80        6.29
      pound |         37       25.87       32.17
       unit |         97       67.83      100.00
------------+-----------------------------------
      Total |        143      100.00

sale amount |
 unit- code |      Freq.     Percent        Cum.
------------+-----------------------------------
      bunch |          4        2.80        2.80
      pound |         37       25.87       28.67
       unit |         97       67.83       96.50
         .s |          5        3.50      100.00
------------+-----------------------------------
      Total |        143      100.00

 sale value |
  (dollars) |      Freq.     Percent        Cum.
------------+-----------------------------------
         .5 |          6        4.20        4.20
          1 |         63       44.06       48.25
          2 |         35       24.48       72.73
          3 |         15       10.49       83.22
          4 |          8        5.59       88.81
          5 |          6        4.20       93.01
          6 |          2        1.40       94.41
          7 |          1        0.70       95.10
          9 |          2        1.40       96.50
         10 |          2        1.40       97.90
         13 |          1        0.70       98.60
         19 |          1        0.70       99.30
         57 |          1        0.70      100.00
------------+-----------------------------------
      Total |        143      100.00

.                 
.         /* Save clean TBF Market Garden 2023 data */
.         save "$root\clean_data\tbf_market_garden_sales_2023_clean.dta", replace
file C:\Users\sethb\Documents\The Brosey Farm\GitHub repositories\The-Brosey-Farm\analytics\clean_data\tbf_market_garden_sales_2023_clean.dta saved

.         
.  
. *=========================================================================================
. * IV) DESCRIPTIVE STATISTICS
. *=========================================================================================     
.         
.         describe _all

Variable      Storage   Display    Value
    name         type    format    label      Variable label
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
sale_date       str10   %10s                  sale date
sale_date_stata float   %td                   sale date- stata
sale_location   str27   %27s                  sale location
sale_location~e long    %27.0g     sale_location_code
                                              sale location- code
sale_location~o byte    %10.0g                sale_location_stall_no
sale_location~c str14   %14s                  sale_location_stall_spec
sale_crop       str29   %29s                  sale crop
sale_crop_code  long    %29.0g     sale_crop_code
                                              sale crop- code
sale_amnt       double  %10.0g                sale amount
sale_unit       str5    %9s                   sale amount unit
sale_unit_code  long    %8.0g      sale_unit_code
                                              sale amount unit- code
sale_value_usd  double  %10.0g                sale value (dollars)

. 
. 
. log close _all
      name:  clean_01
       log:  C:\Users\sethb\Documents\The Brosey Farm\GitHub repositories\The-Brosey-Farm\analytics\Stata_programs\03_tbf_sales_2023_cleaning.log
  log type:  text
 closed on:  20 Sep 2023, 12:45:19
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
