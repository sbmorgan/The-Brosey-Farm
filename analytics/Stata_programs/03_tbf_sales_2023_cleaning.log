--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  clean_01
       log:  C:\Users\sethb\Documents\The Brosey Farm\GitHub repositories\The-Brosey-Farm\analytics\Stata_programs\03_tbf_sales_2023_cleaning.log
  log type:  text
 opened on:  27 Sep 2023, 23:41:06

. 
. 
. *************************************************************************************************
. ***                                                                                           ***
. *** Program name: 03_tbf_sales_2023_cleaning.do                                               ***
. *** Project: TBF Market Garden 2023                                                                       ***
. *** Purpose: Clean TBF Market Garden 2023 sales data                                          ***    
. ***                                                                                                                                                                           
>     ***
. *** Contents:                                                                                             ***
. ***    0) SET UP CODE                                                                                         ***
. ***    I) LOAD RAW DATA                                                                       ***
. ***    II) MANAGE VARIABLES                                                                   ***
. ***    III) CLEAN DATA                                                                        ***
. ***    IV) DESCRIPTIVE STATISTICS                                                             ***
. ***                                                                                           ***
. *** Authors: Seth B. Morgan                                                                               ***
. *** Start date: August 8, 2023                                                                                                    ***
. *** Last date modified: September 27, 2023                                                    ***
. ***                                                                                           ***
. *** Notes:                                                                                    ***
. ***                                                                                           ***
. ***                                                                                           ***
. *************************************************************************************************
. 
. clear all

. version 18.0

. set more off

. set varabbrev off

. pause off

. 
. 
. *=========================================================================================
. * 0) SET UP CODE
. *=========================================================================================      
. 
. /* Set seed */
.         set seed 7122023

.         
. /* Define globals */
. 
.         *Root
.         global root "C:\Users\sethb\Documents\The Brosey Farm\GitHub repositories\The-Brosey-Farm\analytics"

.     adopath ++ "$root"
  [1]              "C:\Users\sethb\Documents\The Brosey Farm\GitHub repositories\The-Brosey-Farm\analytics"
  [2]  (BASE)      "C:\Program Files\Stata18\ado\base/"
  [3]  (SITE)      "C:\Program Files\Stata18\ado\site/"
  [4]              "."
  [5]  (PERSONAL)  "C:\Users\sethb\ado\personal/"
  [6]  (PLUS)      "C:\Users\sethb\ado\plus/"
  [7]  (OLDPLACE)  "c:\ado/"

.     
. 
. *=========================================================================================
. * I) LOAD RAW DATA 
. *=========================================================================================
. 
.         /* Load raw data */
.         import excel "$root\raw_data\Brosey Farming.xlsx", sheet("sales_2023") firstrow clear
(11 vars, 155 obs)

.         keep sale_date-sale_value_usd

.         ds 
sale_date     sale_locat~n  sale_locat~o  sale_locat~c  sale_crop     sale_amnt     sale_unit     sale_value~d

.         
.         /* Save raw TBF Market Garden 2023 data */
.         save "$root\raw_data\tbf_market_garden_sales_2023_raw.dta", replace
file C:\Users\sethb\Documents\The Brosey Farm\GitHub repositories\The-Brosey-Farm\analytics\raw_data\tbf_market_garden_sales_2023_raw.dta saved

.         
.    
. *=========================================================================================
. * II) MANAGE VARIABLES
. *=========================================================================================  
. 
.         /* Add variable labels */
.         label variable sale_date "sale date"

.         label variable sale_location "sale location" 

.         label variable sale_crop "sale crop" 

.         label variable sale_amnt "sale amount" 

.         label variable sale_unit "sale amount unit" 

.         label variable sale_value_usd "sale value (dollars)"

.         
.         /* Manage variable type */
.         describe _all

Variable      Storage   Display    Value
    name         type    format    label      Variable label
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
sale_date       str10   %10s                  sale date
sale_location   str27   %27s                  sale location
sale_location~o byte    %10.0g                sale_location_stall_no
sale_location~c str14   %14s                  sale_location_stall_spec
sale_crop       str29   %29s                  sale crop
sale_amnt       double  %10.0g                sale amount
sale_unit       str5    %9s                   sale amount unit
sale_value_usd  double  %10.0g                sale value (dollars)

.         
.         /* Manage sales date variable */
.         foreach var of varlist *date* {
  2.                 display as input "Variable: `var'"
  3.                 tabulate `var', missing
  4.                 capture confirm string var `var'
  5.                 if _rc!=0 tostring `var', replace
  6.                 generate `var'_year= substr(`var',1,4)
  7.                 generate `var'_month= substr(`var',6,2)
  8.                 generate `var'_day= substr(`var',9,2)
  9.                 foreach var2 of varlist `var'_year `var'_month `var'_day {
 10.                         confirm string var `var2'
 11.                         destring `var2', replace
 12.                 }
 13.                 generate `var'_stata= mdy(`var'_month, `var'_day, `var'_year)
 14.                 drop `var'_year `var'_month `var'_day
 15.                 local varlab : variable label `var'
 16.                 label variable `var'_stata "`varlab'- stata"            
 17.                 format `var'_stata %td
 18.                 order `var'_stata, after(`var')
 19.         }
Variable: sale_date

  sale date |      Freq.     Percent        Cum.
------------+-----------------------------------
 2023-08-05 |         26       16.77       16.77
 2023-08-12 |         18       11.61       28.39
 2023-08-19 |         41       26.45       54.84
 2023-08-26 |         24       15.48       70.32
 2023-08-30 |          1        0.65       70.97
 2023-09-02 |         29       18.71       89.68
 2023-09-07 |          1        0.65       90.32
 2023-09-08 |          1        0.65       90.97
 2023-09-13 |          1        0.65       91.61
 2023-09-14 |          1        0.65       92.26
 2023-09-23 |         12        7.74      100.00
------------+-----------------------------------
      Total |        155      100.00
sale_date_year: all characters numeric; replaced as int
sale_date_month: all characters numeric; replaced as byte
sale_date_day: all characters numeric; replaced as byte

.         
.         /* Convert categorical strings into categorical numerics */
.         local cat_str_list sale_location sale_crop sale_unit

.         tab1 `cat_str_list', missing

-> tabulation of sale_location  

              sale location |      Freq.     Percent        Cum.
----------------------------+-----------------------------------
New Carlisle Farmers Market |        150       96.77       96.77
The Brosey Farm: farm stand |          5        3.23      100.00
----------------------------+-----------------------------------
                      Total |        155      100.00

-> tabulation of sale_crop  

                    sale crop |      Freq.     Percent        Cum.
------------------------------+-----------------------------------
                              |          5        3.23        3.23
          bean- fin de bagnol |          3        1.94        5.16
              carrot- touchon |         14        9.03       14.19
                     cilantro |          4        2.58       16.77
       eggplant- black beauty |         15        9.68       26.45
              pepper- anaheim |         10        6.45       32.90
               pepper- ghost  |          1        0.65       33.55
             pepper- habanero |          1        0.65       34.19
      pepper- jalapeno- early |         22       14.19       48.39
         pepper- sweet banana |         13        8.39       56.77
     pepper- sweet- ca wonder |         19       12.26       69.03
            pumpkin- ct field |          1        0.65       69.68
sweet corn- country gentleman |          3        1.94       71.61
                tomato- amish |         30       19.35       90.97
                 tomato- roma |         14        9.03      100.00
------------------------------+-----------------------------------
                        Total |        155      100.00

-> tabulation of sale_unit  

sale amount |
       unit |      Freq.     Percent        Cum.
------------+-----------------------------------
            |          5        3.23        3.23
      bunch |          4        2.58        5.81
      pound |         42       27.10       32.90
       unit |        104       67.10      100.00
------------+-----------------------------------
      Total |        155      100.00

.         foreach var of varlist `cat_str_list' {
  2.                 if `var'=="." continue
  3.                 encode (`var'), generate(`var'_code)
  4.                 tablist `var' `var'_code, sort(variable) ab(32)
  5.                 tablist `var' `var'_code, sort(variable) nolabel ab(32)
  6.                 local varlab : variable label `var'
  7.                 label variable `var'_code "`varlab'- code"
  8.                 order `var'_code, after(`var')
  9.                 *pause
.         }

  +-------------------------------------------------------------------------------------------------+
  |               sale_location            sale_location_code   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |-------------------------------------------------------------------------------------------------|
  | New Carlisle Farmers Market   New Carlisle Farmers Market      150    96.77       150     96.77 |
  | The Brosey Farm: farm stand   The Brosey Farm: farm stand        5     3.23       155    100.00 |
  +-------------------------------------------------------------------------------------------------+

  +----------------------------------------------------------------------------------------+
  |               sale_location   sale_location_code   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |----------------------------------------------------------------------------------------|
  | New Carlisle Farmers Market                    1      150    96.77       150     96.77 |
  | The Brosey Farm: farm stand                    2        5     3.23       155    100.00 |
  +----------------------------------------------------------------------------------------+

  +-----------------------------------------------------------------------------------------------------+
  |                     sale_crop                  sale_crop_code   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |-----------------------------------------------------------------------------------------------------|
  |                 tomato- amish                   tomato- amish       30    19.35        30     19.35 |
  |       pepper- jalapeno- early         pepper- jalapeno- early       22    14.19        52     33.55 |
  |      pepper- sweet- ca wonder        pepper- sweet- ca wonder       19    12.26        71     45.81 |
  |        eggplant- black beauty          eggplant- black beauty       15     9.68        86     55.48 |
  |               carrot- touchon                 carrot- touchon       14     9.03       100     64.52 |
  |-----------------------------------------------------------------------------------------------------|
  |                  tomato- roma                    tomato- roma       14     9.03       114     73.55 |
  |          pepper- sweet banana            pepper- sweet banana       13     8.39       127     81.94 |
  |               pepper- anaheim                 pepper- anaheim       10     6.45       137     88.39 |
  |                                                             .        5     3.23       142     91.61 |
  |                      cilantro                        cilantro        4     2.58       146     94.19 |
  |-----------------------------------------------------------------------------------------------------|
  |           bean- fin de bagnol             bean- fin de bagnol        3     1.94       149     96.13 |
  | sweet corn- country gentleman   sweet corn- country gentleman        3     1.94       152     98.06 |
  |                pepper- ghost                    pepper- ghost        1     0.65       153     98.71 |
  |              pepper- habanero                pepper- habanero        1     0.65       154     99.35 |
  |             pumpkin- ct field               pumpkin- ct field        1     0.65       155    100.00 |
  +-----------------------------------------------------------------------------------------------------+

  +--------------------------------------------------------------------------------------+
  |                     sale_crop   sale_crop_code   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |--------------------------------------------------------------------------------------|
  |                 tomato- amish               13       30    19.35        30     19.35 |
  |       pepper- jalapeno- early                8       22    14.19        52     33.55 |
  |      pepper- sweet- ca wonder               10       19    12.26        71     45.81 |
  |        eggplant- black beauty                4       15     9.68        86     55.48 |
  |                  tomato- roma               14       14     9.03       100     64.52 |
  |--------------------------------------------------------------------------------------|
  |               carrot- touchon                2       14     9.03       114     73.55 |
  |          pepper- sweet banana                9       13     8.39       127     81.94 |
  |               pepper- anaheim                5       10     6.45       137     88.39 |
  |                                              .        5     3.23       142     91.61 |
  |                      cilantro                3        4     2.58       146     94.19 |
  |--------------------------------------------------------------------------------------|
  |           bean- fin de bagnol                1        3     1.94       149     96.13 |
  | sweet corn- country gentleman               12        3     1.94       152     98.06 |
  |              pepper- habanero                7        1     0.65       153     98.71 |
  |                pepper- ghost                 6        1     0.65       154     99.35 |
  |             pumpkin- ct field               11        1     0.65       155    100.00 |
  +--------------------------------------------------------------------------------------+

  +------------------------------------------------------------------+
  | sale_unit   sale_unit_code   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |------------------------------------------------------------------|
  |      unit             unit      104    67.10       104     67.10 |
  |     pound            pound       42    27.10       146     94.19 |
  |                          .        5     3.23       151     97.42 |
  |     bunch            bunch        4     2.58       155    100.00 |
  +------------------------------------------------------------------+

  +------------------------------------------------------------------+
  | sale_unit   sale_unit_code   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |------------------------------------------------------------------|
  |      unit                3      104    67.10       104     67.10 |
  |     pound                2       42    27.10       146     94.19 |
  |                          .        5     3.23       151     97.42 |
  |     bunch                1        4     2.58       155    100.00 |
  +------------------------------------------------------------------+

. 
.     
. *=========================================================================================
. * III) CLEAN DATA
. *=========================================================================================     
. 
.         /* Clean missing values */
.         foreach var of varlist sale_location_stall_no sale_crop sale_crop_code sale_amnt sale_unit sale_unit_code {
  2.                 capture confirm numeric variable `var'
  3.                 if _rc==0 {
  4.                         assert `var'==. if sale_location== "The Brosey Farm: farm stand"
  5.                         replace `var'=.s if sale_location== "The Brosey Farm: farm stand"
  6.                 }               
  7.                 else {
  8.                         assert `var'=="" if sale_location== "The Brosey Farm: farm stand"
  9.                         replace `var'=".s" if sale_location== "The Brosey Farm: farm stand"                     
 10.                 }
 11.         }
(5 real changes made, 5 to missing)
(5 real changes made)
(5 real changes made, 5 to missing)
(5 real changes made, 5 to missing)
(5 real changes made)
(5 real changes made, 5 to missing)

.         
.         tablist sale_location sale_location_stall_no sale_location_stall_spec, sort(variable) ab(32)

  +-----------------------------------------------------------------------------------------------------------------------+
  |               sale_location   sale_location_stall_no   sale_location_stall_spec   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |-----------------------------------------------------------------------------------------------------------------------|
  | New Carlisle Farmers Market                        5             outside, north       80    51.61        80     51.61 |
  | New Carlisle Farmers Market                        4             outside, north       26    16.77       106     68.39 |
  | New Carlisle Farmers Market                        .              outside, east       26    16.77       132     85.16 |
  | New Carlisle Farmers Market                        8             outside, north       18    11.61       150     96.77 |
  | The Brosey Farm: farm stand                       .s                   roadside        5     3.23       155    100.00 |
  +-----------------------------------------------------------------------------------------------------------------------+

.         replace sale_location_stall_no= .m if sale_location_stall_no==.
(26 real changes made, 26 to missing)

.         replace sale_location_stall_spec= ".m" if sale_location_stall_spec==""
(0 real changes made)

.         
.         foreach var of varlist _all {
  2.                 tabulate `var', missing
  3.                 capture confirm numeric variable `var'
  4.                 if _rc==0 assert `var' !=.
  5.                 else assert `var' !=""
  6.         }       

  sale date |      Freq.     Percent        Cum.
------------+-----------------------------------
 2023-08-05 |         26       16.77       16.77
 2023-08-12 |         18       11.61       28.39
 2023-08-19 |         41       26.45       54.84
 2023-08-26 |         24       15.48       70.32
 2023-08-30 |          1        0.65       70.97
 2023-09-02 |         29       18.71       89.68
 2023-09-07 |          1        0.65       90.32
 2023-09-08 |          1        0.65       90.97
 2023-09-13 |          1        0.65       91.61
 2023-09-14 |          1        0.65       92.26
 2023-09-23 |         12        7.74      100.00
------------+-----------------------------------
      Total |        155      100.00

 sale date- |
      stata |      Freq.     Percent        Cum.
------------+-----------------------------------
  05aug2023 |         26       16.77       16.77
  12aug2023 |         18       11.61       28.39
  19aug2023 |         41       26.45       54.84
  26aug2023 |         24       15.48       70.32
  30aug2023 |          1        0.65       70.97
  02sep2023 |         29       18.71       89.68
  07sep2023 |          1        0.65       90.32
  08sep2023 |          1        0.65       90.97
  13sep2023 |          1        0.65       91.61
  14sep2023 |          1        0.65       92.26
  23sep2023 |         12        7.74      100.00
------------+-----------------------------------
      Total |        155      100.00

              sale location |      Freq.     Percent        Cum.
----------------------------+-----------------------------------
New Carlisle Farmers Market |        150       96.77       96.77
The Brosey Farm: farm stand |          5        3.23      100.00
----------------------------+-----------------------------------
                      Total |        155      100.00

        sale location- code |      Freq.     Percent        Cum.
----------------------------+-----------------------------------
New Carlisle Farmers Market |        150       96.77       96.77
The Brosey Farm: farm stand |          5        3.23      100.00
----------------------------+-----------------------------------
                      Total |        155      100.00

sale_locati |
on_stall_no |      Freq.     Percent        Cum.
------------+-----------------------------------
          4 |         26       16.77       16.77
          5 |         80       51.61       68.39
          8 |         18       11.61       80.00
         .m |         26       16.77       96.77
         .s |          5        3.23      100.00
------------+-----------------------------------
      Total |        155      100.00

sale_location_ |
    stall_spec |      Freq.     Percent        Cum.
---------------+-----------------------------------
 outside, east |         26       16.77       16.77
outside, north |        124       80.00       96.77
      roadside |          5        3.23      100.00
---------------+-----------------------------------
         Total |        155      100.00

                    sale crop |      Freq.     Percent        Cum.
------------------------------+-----------------------------------
                           .s |          5        3.23        3.23
          bean- fin de bagnol |          3        1.94        5.16
              carrot- touchon |         14        9.03       14.19
                     cilantro |          4        2.58       16.77
       eggplant- black beauty |         15        9.68       26.45
              pepper- anaheim |         10        6.45       32.90
               pepper- ghost  |          1        0.65       33.55
             pepper- habanero |          1        0.65       34.19
      pepper- jalapeno- early |         22       14.19       48.39
         pepper- sweet banana |         13        8.39       56.77
     pepper- sweet- ca wonder |         19       12.26       69.03
            pumpkin- ct field |          1        0.65       69.68
sweet corn- country gentleman |          3        1.94       71.61
                tomato- amish |         30       19.35       90.97
                 tomato- roma |         14        9.03      100.00
------------------------------+-----------------------------------
                        Total |        155      100.00

              sale crop- code |      Freq.     Percent        Cum.
------------------------------+-----------------------------------
          bean- fin de bagnol |          3        1.94        1.94
              carrot- touchon |         14        9.03       10.97
                     cilantro |          4        2.58       13.55
       eggplant- black beauty |         15        9.68       23.23
              pepper- anaheim |         10        6.45       29.68
               pepper- ghost  |          1        0.65       30.32
             pepper- habanero |          1        0.65       30.97
      pepper- jalapeno- early |         22       14.19       45.16
         pepper- sweet banana |         13        8.39       53.55
     pepper- sweet- ca wonder |         19       12.26       65.81
            pumpkin- ct field |          1        0.65       66.45
sweet corn- country gentleman |          3        1.94       68.39
                tomato- amish |         30       19.35       87.74
                 tomato- roma |         14        9.03       96.77
                           .s |          5        3.23      100.00
------------------------------+-----------------------------------
                        Total |        155      100.00

sale amount |      Freq.     Percent        Cum.
------------+-----------------------------------
         .5 |          6        3.87        3.87
          1 |         46       29.68       33.55
        1.5 |          2        1.29       34.84
          2 |         28       18.06       52.90
        2.5 |          2        1.29       54.19
          3 |         14        9.03       63.23
        3.5 |          1        0.65       63.87
          4 |         16       10.32       74.19
          5 |         14        9.03       83.23
          6 |          6        3.87       87.10
          7 |          3        1.94       89.03
          8 |          4        2.58       91.61
          9 |          2        1.29       92.90
         10 |          2        1.29       94.19
         12 |          1        0.65       94.84
         20 |          1        0.65       95.48
         28 |          1        0.65       96.13
         55 |          1        0.65       96.77
         .s |          5        3.23      100.00
------------+-----------------------------------
      Total |        155      100.00

sale amount |
       unit |      Freq.     Percent        Cum.
------------+-----------------------------------
         .s |          5        3.23        3.23
      bunch |          4        2.58        5.81
      pound |         42       27.10       32.90
       unit |        104       67.10      100.00
------------+-----------------------------------
      Total |        155      100.00

sale amount |
 unit- code |      Freq.     Percent        Cum.
------------+-----------------------------------
      bunch |          4        2.58        2.58
      pound |         42       27.10       29.68
       unit |        104       67.10       96.77
         .s |          5        3.23      100.00
------------+-----------------------------------
      Total |        155      100.00

 sale value |
  (dollars) |      Freq.     Percent        Cum.
------------+-----------------------------------
         .5 |          6        3.87        3.87
          1 |         70       45.16       49.03
          2 |         39       25.16       74.19
          3 |         16       10.32       84.52
          4 |          8        5.16       89.68
          5 |          6        3.87       93.55
          6 |          2        1.29       94.84
          7 |          1        0.65       95.48
          9 |          2        1.29       96.77
         10 |          2        1.29       98.06
         13 |          1        0.65       98.71
         19 |          1        0.65       99.35
         57 |          1        0.65      100.00
------------+-----------------------------------
      Total |        155      100.00

.                 
.         /* Save clean TBF Market Garden 2023 data */
.         quietly compress

.         save "$root\modified_data\tbf_market_garden_sales_2023_clean.dta", replace
file C:\Users\sethb\Documents\The Brosey Farm\GitHub repositories\The-Brosey-Farm\analytics\modified_data\tbf_market_garden_sales_2023_clean.dta saved

.         
.  
. *=========================================================================================
. * IV) DESCRIPTIVE STATISTICS
. *=========================================================================================     
.         
.         describe _all

Variable      Storage   Display    Value
    name         type    format    label      Variable label
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
sale_date       str10   %10s                  sale date
sale_date_stata int     %td                   sale date- stata
sale_location   str27   %27s                  sale location
sale_location~e byte    %27.0g     sale_location_code
                                              sale location- code
sale_location~o byte    %10.0g                sale_location_stall_no
sale_location~c str14   %14s                  sale_location_stall_spec
sale_crop       str29   %29s                  sale crop
sale_crop_code  byte    %29.0g     sale_crop_code
                                              sale crop- code
sale_amnt       double  %10.0g                sale amount
sale_unit       str5    %9s                   sale amount unit
sale_unit_code  byte    %8.0g      sale_unit_code
                                              sale amount unit- code
sale_value_usd  double  %10.0g                sale value (dollars)

. 
. 
. log close _all
      name:  clean_01
       log:  C:\Users\sethb\Documents\The Brosey Farm\GitHub repositories\The-Brosey-Farm\analytics\Stata_programs\03_tbf_sales_2023_cleaning.log
  log type:  text
 closed on:  27 Sep 2023, 23:41:07
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
