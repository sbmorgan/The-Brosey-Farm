-----------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  clean_01
       log:  C:\Users\sethb\Documents\The Brosey Farm\GitHub repositories\The-Brosey-Farm\analytics\Stata_programs\03_tbf_sales_2023_cleaning.log
  log type:  text
 opened on:  31 Aug 2023, 18:03:22

. 
. 
. *************************************************************************************************
. ***                                                                                           ***
. *** Program name: 03_tbf_sales_2023_cleaning.do                                               ***
. *** Project: TBF Market Garden 2023                                                                       ***
. *** Purpose: Clean TBF Market Garden 2023 sales data                                          ***    
. ***                                                                                                                                                            
>                    ***
. *** Contents:                                                                                             ***
. ***    0) SET UP CODE                                                                                         ***
. ***    I) LOAD RAW DATA                                                                       ***
. ***    II) MANAGE VARIABLES                                                                   ***
. ***    III) CLEAN DATA                                                                        ***
. ***    IV) DESCRIPTIVE STATISTICS                                                             ***
. ***                                                                                           ***
. *** Authors: Seth B. Morgan                                                                               ***
. *** Start date: August 8, 2023                                                                                                    ***
. *** Last date modified: August 31, 2023                                                        ***
. ***                                                                                           ***
. *** Notes:                                                                                    ***
. ***                                                                                           ***
. ***                                                                                           ***
. *************************************************************************************************
. 
. clear all

. version 18.0

. set more off

. set varabbrev off

. pause off

. 
. 
. *=========================================================================================
. * 0) SET UP CODE
. *=========================================================================================      
. 
. /* Set seed */
.         set seed 7122023

.         
. /* Define globals */
. 
.         *Root
.         global root "C:\Users\sethb\Documents\The Brosey Farm\GitHub repositories\The-Brosey-Farm\analytics"

.     adopath ++ "$root"
  [1]              "C:\Users\sethb\Documents\The Brosey Farm\GitHub repositories\The-Brosey-Farm\analytics"
  [2]  (BASE)      "C:\Program Files\Stata18\ado\base/"
  [3]  (SITE)      "C:\Program Files\Stata18\ado\site/"
  [4]              "."
  [5]  (PERSONAL)  "C:\Users\sethb\ado\personal/"
  [6]  (PLUS)      "C:\Users\sethb\ado\plus/"
  [7]  (OLDPLACE)  "c:\ado/"

.     
. 
. *=========================================================================================
. * I) LOAD RAW DATA 
. *=========================================================================================
. 
.         /* Load raw data */
.         import excel "$root\raw_data\Brosey Farming.xlsx", sheet("sales_2023") firstrow clear
(11 vars, 84 obs)

.         keep sale_date-sale_value_usd

.         ds 
sale_date     sale_locat~n  sale_locat~o  sale_locat~c  sale_crop     sale_amnt     sale_unit     sale_value~d

.         
.         /* Save raw TBF Market Garden 2023 data */
.         save "$root\raw_data\tbf_market_garden_sales_2023_raw.dta", replace
file C:\Users\sethb\Documents\The Brosey Farm\GitHub repositories\The-Brosey-Farm\analytics\raw_data\tbf_market_garden_sales_2023_raw.dta saved

.         
.    
. *=========================================================================================
. * II) MANAGE VARIABLES
. *=========================================================================================  
. 
.         /* Add variable labels */
.         label variable sale_date "sale date"

.         label variable sale_location "sale location" 

.         label variable sale_crop "sale crop" 

.         label variable sale_amnt "sale amount" 

.         label variable sale_unit "sale amount unit" 

.         label variable sale_value_usd "sale value (dollars)"

.         
.         /* Manage variable type */
.         describe _all

Variable      Storage   Display    Value
    name         type    format    label      Variable label
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
sale_date       str10   %10s                  sale date
sale_location   str27   %27s                  sale location
sale_location~o byte    %10.0g                sale_location_stall_no
sale_location~c str14   %14s                  sale_location_stall_spec
sale_crop       str29   %29s                  sale crop
sale_amnt       double  %10.0g                sale amount
sale_unit       str5    %9s                   sale amount unit
sale_value_usd  byte    %10.0g                sale value (dollars)

.         
.         /* Manage sales date variable */
.         foreach var of varlist *date* {
  2.                 display as input "Variable: `var'"
  3.                 tabulate `var', missing
  4.                 capture confirm string var `var'
  5.                 if _rc!=0 tostring `var', replace
  6.                 generate `var'_year= substr(`var',1,4)
  7.                 generate `var'_month= substr(`var',6,2)
  8.                 generate `var'_day= substr(`var',9,2)
  9.                 foreach var2 of varlist `var'_year `var'_month `var'_day {
 10.                         confirm string var `var2'
 11.                         destring `var2', replace
 12.                 }
 13.                 generate `var'_stata= mdy(`var'_month, `var'_day, `var'_year)
 14.                 drop `var'_year `var'_month `var'_day
 15.                 local varlab : variable label `var'
 16.                 label variable `var'_stata "`varlab'- stata"            
 17.                 format `var'_stata %td
 18.                 order `var'_stata, after(`var')
 19.         }
Variable: sale_date

  sale date |      Freq.     Percent        Cum.
------------+-----------------------------------
 2023-08-05 |         26       30.95       30.95
 2023-08-12 |         18       21.43       52.38
 2023-08-19 |         15       17.86       70.24
 2023-08-26 |         24       28.57       98.81
 2023-08-30 |          1        1.19      100.00
------------+-----------------------------------
      Total |         84      100.00
sale_date_year: all characters numeric; replaced as int
sale_date_month: all characters numeric; replaced as byte
sale_date_day: all characters numeric; replaced as byte

.         
.         /* Convert categorical strings into categorical numerics */
.         local cat_str_list sale_location sale_crop sale_unit

.         tab1 `cat_str_list', missing

-> tabulation of sale_location  

              sale location |      Freq.     Percent        Cum.
----------------------------+-----------------------------------
New Carlisle Farmers Market |         83       98.81       98.81
The Brosey Farm: farm stand |          1        1.19      100.00
----------------------------+-----------------------------------
                      Total |         84      100.00

-> tabulation of sale_crop  

                    sale crop |      Freq.     Percent        Cum.
------------------------------+-----------------------------------
                              |          1        1.19        1.19
          bean- fin de bagnol |          3        3.57        4.76
              carrot- touchon |         11       13.10       17.86
                     cilantro |          4        4.76       22.62
       eggplant- black beauty |          8        9.52       32.14
              pepper- anaheim |          7        8.33       40.48
      pepper- jalapeno- early |         14       16.67       57.14
         pepper- sweet banana |          4        4.76       61.90
     pepper- sweet- ca wonder |         13       15.48       77.38
sweet corn- country gentleman |          3        3.57       80.95
                tomato- amish |         13       15.48       96.43
                 tomato- roma |          3        3.57      100.00
------------------------------+-----------------------------------
                        Total |         84      100.00

-> tabulation of sale_unit  

sale amount |
       unit |      Freq.     Percent        Cum.
------------+-----------------------------------
            |          1        1.19        1.19
      bunch |          4        4.76        5.95
      pound |         15       17.86       23.81
       unit |         64       76.19      100.00
------------+-----------------------------------
      Total |         84      100.00

.         foreach var of varlist `cat_str_list' {
  2.                 if `var'=="." continue
  3.                 encode (`var'), generate(`var'_code)
  4.                 tablist `var' `var'_code, sort(variable) ab(32)
  5.                 tablist `var' `var'_code, sort(variable) nolabel ab(32)
  6.                 local varlab : variable label `var'
  7.                 label variable `var'_code "`varlab'- code"
  8.                 order `var'_code, after(`var')
  9.                 *pause
.         }

  +-------------------------------------------------------------------------------------------------+
  |               sale_location            sale_location_code   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |-------------------------------------------------------------------------------------------------|
  | New Carlisle Farmers Market   New Carlisle Farmers Market       83    98.81        83     98.81 |
  | The Brosey Farm: farm stand   The Brosey Farm: farm stand        1     1.19        84    100.00 |
  +-------------------------------------------------------------------------------------------------+

  +----------------------------------------------------------------------------------------+
  |               sale_location   sale_location_code   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |----------------------------------------------------------------------------------------|
  | New Carlisle Farmers Market                    1       83    98.81        83     98.81 |
  | The Brosey Farm: farm stand                    2        1     1.19        84    100.00 |
  +----------------------------------------------------------------------------------------+

  +-----------------------------------------------------------------------------------------------------+
  |                     sale_crop                  sale_crop_code   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |-----------------------------------------------------------------------------------------------------|
  |       pepper- jalapeno- early         pepper- jalapeno- early       14    16.67        14     16.67 |
  |      pepper- sweet- ca wonder        pepper- sweet- ca wonder       13    15.48        27     32.14 |
  |                 tomato- amish                   tomato- amish       13    15.48        40     47.62 |
  |               carrot- touchon                 carrot- touchon       11    13.10        51     60.71 |
  |        eggplant- black beauty          eggplant- black beauty        8     9.52        59     70.24 |
  |-----------------------------------------------------------------------------------------------------|
  |               pepper- anaheim                 pepper- anaheim        7     8.33        66     78.57 |
  |          pepper- sweet banana            pepper- sweet banana        4     4.76        70     83.33 |
  |                      cilantro                        cilantro        4     4.76        74     88.10 |
  | sweet corn- country gentleman   sweet corn- country gentleman        3     3.57        77     91.67 |
  |                  tomato- roma                    tomato- roma        3     3.57        80     95.24 |
  |-----------------------------------------------------------------------------------------------------|
  |           bean- fin de bagnol             bean- fin de bagnol        3     3.57        83     98.81 |
  |                                                             .        1     1.19        84    100.00 |
  +-----------------------------------------------------------------------------------------------------+

  +--------------------------------------------------------------------------------------+
  |                     sale_crop   sale_crop_code   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |--------------------------------------------------------------------------------------|
  |       pepper- jalapeno- early                6       14    16.67        14     16.67 |
  |      pepper- sweet- ca wonder                8       13    15.48        27     32.14 |
  |                 tomato- amish               10       13    15.48        40     47.62 |
  |               carrot- touchon                2       11    13.10        51     60.71 |
  |        eggplant- black beauty                4        8     9.52        59     70.24 |
  |--------------------------------------------------------------------------------------|
  |               pepper- anaheim                5        7     8.33        66     78.57 |
  |                      cilantro                3        4     4.76        70     83.33 |
  |          pepper- sweet banana                7        4     4.76        74     88.10 |
  |                  tomato- roma               11        3     3.57        77     91.67 |
  |           bean- fin de bagnol                1        3     3.57        80     95.24 |
  |--------------------------------------------------------------------------------------|
  | sweet corn- country gentleman                9        3     3.57        83     98.81 |
  |                                              .        1     1.19        84    100.00 |
  +--------------------------------------------------------------------------------------+

  +------------------------------------------------------------------+
  | sale_unit   sale_unit_code   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |------------------------------------------------------------------|
  |      unit             unit       64    76.19        64     76.19 |
  |     pound            pound       15    17.86        79     94.05 |
  |     bunch            bunch        4     4.76        83     98.81 |
  |                          .        1     1.19        84    100.00 |
  +------------------------------------------------------------------+

  +------------------------------------------------------------------+
  | sale_unit   sale_unit_code   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |------------------------------------------------------------------|
  |      unit                3       64    76.19        64     76.19 |
  |     pound                2       15    17.86        79     94.05 |
  |     bunch                1        4     4.76        83     98.81 |
  |                          .        1     1.19        84    100.00 |
  +------------------------------------------------------------------+

. 
.     
. *=========================================================================================
. * III) CLEAN DATA
. *=========================================================================================     
. 
.         /* Clean missing values */
.         foreach var of varlist sale_location_stall_no sale_crop sale_crop_code sale_amnt sale_unit sale_unit_code {
  2.                 capture confirm numeric variable `var'
  3.                 if _rc==0 {
  4.                         assert `var'==. if sale_location== "The Brosey Farm: farm stand"
  5.                         replace `var'=.s if sale_location== "The Brosey Farm: farm stand"
  6.                 }               
  7.                 else {
  8.                         assert `var'=="" if sale_location== "The Brosey Farm: farm stand"
  9.                         replace `var'=".s" if sale_location== "The Brosey Farm: farm stand"                     
 10.                 }
 11.         }
(1 real change made, 1 to missing)
(1 real change made)
(1 real change made, 1 to missing)
(1 real change made, 1 to missing)
(1 real change made)
(1 real change made, 1 to missing)

.         
.         tablist sale_location sale_location_stall_no sale_location_stall_spec, sort(variable) ab(32)

  +-----------------------------------------------------------------------------------------------------------------------+
  |               sale_location   sale_location_stall_no   sale_location_stall_spec   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |-----------------------------------------------------------------------------------------------------------------------|
  | New Carlisle Farmers Market                        5             outside, north       39    46.43        39     46.43 |
  | New Carlisle Farmers Market                        .              outside, east       26    30.95        65     77.38 |
  | New Carlisle Farmers Market                        8             outside, north       18    21.43        83     98.81 |
  | The Brosey Farm: farm stand                       .s                   roadside        1     1.19        84    100.00 |
  +-----------------------------------------------------------------------------------------------------------------------+

.         replace sale_location_stall_no= .m if sale_location_stall_no==.
(26 real changes made, 26 to missing)

.         replace sale_location_stall_spec= ".m" if sale_location_stall_spec==""
(0 real changes made)

.         
.         foreach var of varlist _all {
  2.                 tabulate `var', missing
  3.                 capture confirm numeric variable `var'
  4.                 if _rc==0 assert `var' !=.
  5.                 else assert `var' !=""
  6.         }       

  sale date |      Freq.     Percent        Cum.
------------+-----------------------------------
 2023-08-05 |         26       30.95       30.95
 2023-08-12 |         18       21.43       52.38
 2023-08-19 |         15       17.86       70.24
 2023-08-26 |         24       28.57       98.81
 2023-08-30 |          1        1.19      100.00
------------+-----------------------------------
      Total |         84      100.00

 sale date- |
      stata |      Freq.     Percent        Cum.
------------+-----------------------------------
  05aug2023 |         26       30.95       30.95
  12aug2023 |         18       21.43       52.38
  19aug2023 |         15       17.86       70.24
  26aug2023 |         24       28.57       98.81
  30aug2023 |          1        1.19      100.00
------------+-----------------------------------
      Total |         84      100.00

              sale location |      Freq.     Percent        Cum.
----------------------------+-----------------------------------
New Carlisle Farmers Market |         83       98.81       98.81
The Brosey Farm: farm stand |          1        1.19      100.00
----------------------------+-----------------------------------
                      Total |         84      100.00

        sale location- code |      Freq.     Percent        Cum.
----------------------------+-----------------------------------
New Carlisle Farmers Market |         83       98.81       98.81
The Brosey Farm: farm stand |          1        1.19      100.00
----------------------------+-----------------------------------
                      Total |         84      100.00

sale_locati |
on_stall_no |      Freq.     Percent        Cum.
------------+-----------------------------------
          5 |         39       46.43       46.43
          8 |         18       21.43       67.86
         .m |         26       30.95       98.81
         .s |          1        1.19      100.00
------------+-----------------------------------
      Total |         84      100.00

sale_location_ |
    stall_spec |      Freq.     Percent        Cum.
---------------+-----------------------------------
 outside, east |         26       30.95       30.95
outside, north |         57       67.86       98.81
      roadside |          1        1.19      100.00
---------------+-----------------------------------
         Total |         84      100.00

                    sale crop |      Freq.     Percent        Cum.
------------------------------+-----------------------------------
                           .s |          1        1.19        1.19
          bean- fin de bagnol |          3        3.57        4.76
              carrot- touchon |         11       13.10       17.86
                     cilantro |          4        4.76       22.62
       eggplant- black beauty |          8        9.52       32.14
              pepper- anaheim |          7        8.33       40.48
      pepper- jalapeno- early |         14       16.67       57.14
         pepper- sweet banana |          4        4.76       61.90
     pepper- sweet- ca wonder |         13       15.48       77.38
sweet corn- country gentleman |          3        3.57       80.95
                tomato- amish |         13       15.48       96.43
                 tomato- roma |          3        3.57      100.00
------------------------------+-----------------------------------
                        Total |         84      100.00

              sale crop- code |      Freq.     Percent        Cum.
------------------------------+-----------------------------------
          bean- fin de bagnol |          3        3.57        3.57
              carrot- touchon |         11       13.10       16.67
                     cilantro |          4        4.76       21.43
       eggplant- black beauty |          8        9.52       30.95
              pepper- anaheim |          7        8.33       39.29
      pepper- jalapeno- early |         14       16.67       55.95
         pepper- sweet banana |          4        4.76       60.71
     pepper- sweet- ca wonder |         13       15.48       76.19
sweet corn- country gentleman |          3        3.57       79.76
                tomato- amish |         13       15.48       95.24
                 tomato- roma |          3        3.57       98.81
                           .s |          1        1.19      100.00
------------------------------+-----------------------------------
                        Total |         84      100.00

sale amount |      Freq.     Percent        Cum.
------------+-----------------------------------
         .5 |          2        2.38        2.38
          1 |         20       23.81       26.19
          2 |         18       21.43       47.62
        2.5 |          1        1.19       48.81
          3 |          7        8.33       57.14
          4 |         14       16.67       73.81
          5 |          6        7.14       80.95
          6 |          4        4.76       85.71
          7 |          2        2.38       88.10
          8 |          2        2.38       90.48
          9 |          2        2.38       92.86
         10 |          2        2.38       95.24
         20 |          1        1.19       96.43
         28 |          1        1.19       97.62
         55 |          1        1.19       98.81
         .s |          1        1.19      100.00
------------+-----------------------------------
      Total |         84      100.00

sale amount |
       unit |      Freq.     Percent        Cum.
------------+-----------------------------------
         .s |          1        1.19        1.19
      bunch |          4        4.76        5.95
      pound |         15       17.86       23.81
       unit |         64       76.19      100.00
------------+-----------------------------------
      Total |         84      100.00

sale amount |
 unit- code |      Freq.     Percent        Cum.
------------+-----------------------------------
      bunch |          4        4.76        4.76
      pound |         15       17.86       22.62
       unit |         64       76.19       98.81
         .s |          1        1.19      100.00
------------+-----------------------------------
      Total |         84      100.00

 sale value |
  (dollars) |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         38       45.24       45.24
          2 |         21       25.00       70.24
          3 |         12       14.29       84.52
          4 |          4        4.76       89.29
          5 |          5        5.95       95.24
          6 |          2        2.38       97.62
          9 |          1        1.19       98.81
         10 |          1        1.19      100.00
------------+-----------------------------------
      Total |         84      100.00

.                 
.         /* Save clean TBF Market Garden 2023 data */
.         save "$root\tbf_market_garden_sales_2023_clean.dta", replace
file C:\Users\sethb\Documents\The Brosey Farm\GitHub repositories\The-Brosey-Farm\analytics\tbf_market_garden_sales_2023_clean.dta saved

.         
.  
. *=========================================================================================
. * IV) DESCRIPTIVE STATISTICS
. *=========================================================================================     
.         
.         describe _all

Variable      Storage   Display    Value
    name         type    format    label      Variable label
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
sale_date       str10   %10s                  sale date
sale_date_stata float   %td                   sale date- stata
sale_location   str27   %27s                  sale location
sale_location~e long    %27.0g     sale_location_code
                                              sale location- code
sale_location~o byte    %10.0g                sale_location_stall_no
sale_location~c str14   %14s                  sale_location_stall_spec
sale_crop       str29   %29s                  sale crop
sale_crop_code  long    %29.0g     sale_crop_code
                                              sale crop- code
sale_amnt       double  %10.0g                sale amount
sale_unit       str5    %9s                   sale amount unit
sale_unit_code  long    %8.0g      sale_unit_code
                                              sale amount unit- code
sale_value_usd  byte    %10.0g                sale value (dollars)

. 
. 
. log close _all
      name:  clean_01
       log:  C:\Users\sethb\Documents\The Brosey Farm\GitHub repositories\The-Brosey-Farm\analytics\Stata_programs\03_tbf_sales_2023_cleaning.log
  log type:  text
 closed on:  31 Aug 2023, 18:03:22
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
