------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  clean_01
       log:  C:\Users\sethb\Documents\The Brosey Farm\GitHub repositories\The-Brosey-Farm\analytics\Stata_programs\03_tbf_sales_2023_cleaning.log
  log type:  text
 opened on:  12 Oct 2023, 23:28:25

. 
. 
. *************************************************************************************************
. ***                                                                                           ***
. *** Program name: 03_tbf_sales_2023_cleaning.do                                               ***
. *** Project: TBF Market Garden 2023                                                                       ***
. *** Purpose: Clean TBF Market Garden 2023 sales data                                          ***    
. ***                                                                                                                                                                               ***
. *** Contents:                                                                                             ***
. ***    0) SET UP CODE                                                                                         ***
. ***    I) LOAD RAW DATA                                                                       ***
. ***    II) MANAGE VARIABLES                                                                   ***
. ***    III) CLEAN DATA                                                                        ***
. ***    IV) DESCRIPTIVE STATISTICS                                                             ***
. ***                                                                                           ***
. *** Authors: Seth B. Morgan                                                                               ***
. *** Start date: August 8, 2023                                                                                                    ***
. *** Last date modified: September 27, 2023                                                    ***
. ***                                                                                           ***
. *** Notes:                                                                                    ***
. ***                                                                                           ***
. ***                                                                                           ***
. *************************************************************************************************
. 
. clear all

. version 18.0

. set more off

. set varabbrev off

. pause off

. 
. 
. *=========================================================================================
. * 0) SET UP CODE
. *=========================================================================================      
. 
. /* Set seed */
.         set seed 7122023

.         
. /* Define globals */
. 
.         *Root
.         global root "C:\Users\sethb\Documents\The Brosey Farm\GitHub repositories\The-Brosey-Farm\analytics"

.     adopath ++ "$root"
  [1]              "C:\Users\sethb\Documents\The Brosey Farm\GitHub repositories\The-Brosey-Farm\analytics"
  [2]  (BASE)      "C:\Program Files\Stata18\ado\base/"
  [3]  (SITE)      "C:\Program Files\Stata18\ado\site/"
  [4]              "."
  [5]  (PERSONAL)  "C:\Users\sethb\ado\personal/"
  [6]  (PLUS)      "C:\Users\sethb\ado\plus/"
  [7]  (OLDPLACE)  "c:\ado/"

.     
. 
. *=========================================================================================
. * I) LOAD RAW DATA 
. *=========================================================================================
. 
.         /* Load raw data */
.         import excel "$root\raw_data\Brosey Farming.xlsx", sheet("sales_2023") firstrow clear
(11 vars, 175 obs)

.         keep sale_date-sale_value_usd

.         ds 
sale_date     sale_locat~n  sale_locat~o  sale_locat~c  sale_crop     sale_amnt     sale_unit     sale_value~d

.         
.         /* Save raw TBF Market Garden 2023 data */
.         save "$root\raw_data\tbf_market_garden_sales_2023_raw.dta", replace
file C:\Users\sethb\Documents\The Brosey Farm\GitHub repositories\The-Brosey-Farm\analytics\raw_data\tbf_market_garden_sales_2023_raw.dta saved

.         
.    
. *=========================================================================================
. * II) MANAGE VARIABLES
. *=========================================================================================  
. 
.         /* Add variable labels */
.         label variable sale_date "sale date"

.         label variable sale_location "sale location" 

.         label variable sale_crop "sale crop" 

.         label variable sale_amnt "sale amount" 

.         label variable sale_unit "sale amount unit" 

.         label variable sale_value_usd "sale value (dollars)"

.         
.         /* Manage variable type */
.         describe _all

Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
sale_date       str10   %10s                  sale date
sale_location   str27   %27s                  sale location
sale_location~o byte    %10.0g                sale_location_stall_no
sale_location~c str14   %14s                  sale_location_stall_spec
sale_crop       str29   %29s                  sale crop
sale_amnt       double  %10.0g                sale amount
sale_unit       str5    %9s                   sale amount unit
sale_value_usd  double  %10.0g                sale value (dollars)

.         
.         /* Manage sales date variable */
.         foreach var of varlist *date* {
  2.                 display as input "Variable: `var'"
  3.                 tabulate `var', missing
  4.                 capture confirm string var `var'
  5.                 if _rc!=0 tostring `var', replace
  6.                 generate `var'_year= substr(`var',1,4)
  7.                 generate `var'_month= substr(`var',6,2)
  8.                 generate `var'_day= substr(`var',9,2)
  9.                 foreach var2 of varlist `var'_year `var'_month `var'_day {
 10.                         confirm string var `var2'
 11.                         destring `var2', replace
 12.                 }
 13.                 generate `var'_stata= mdy(`var'_month, `var'_day, `var'_year)
 14.                 drop `var'_year `var'_month `var'_day
 15.                 local varlab : variable label `var'
 16.                 label variable `var'_stata "`varlab'- stata"            
 17.                 format `var'_stata %td
 18.                 order `var'_stata, after(`var')
 19.         }
Variable: sale_date

  sale date |      Freq.     Percent        Cum.
------------+-----------------------------------
 2023-08-05 |         26       14.86       14.86
 2023-08-12 |         18       10.29       25.14
 2023-08-19 |         41       23.43       48.57
 2023-08-26 |         24       13.71       62.29
 2023-08-30 |          1        0.57       62.86
 2023-09-02 |         29       16.57       79.43
 2023-09-07 |          1        0.57       80.00
 2023-09-08 |          1        0.57       80.57
 2023-09-13 |          1        0.57       81.14
 2023-09-14 |          1        0.57       81.71
 2023-09-23 |         12        6.86       88.57
 2023-09-30 |         15        8.57       97.14
 2023-10-03 |          1        0.57       97.71
 2023-10-04 |          2        1.14       98.86
 2023-10-09 |          1        0.57       99.43
 2023-10-11 |          1        0.57      100.00
------------+-----------------------------------
      Total |        175      100.00
sale_date_year: all characters numeric; replaced as int
sale_date_month: all characters numeric; replaced as byte
sale_date_day: all characters numeric; replaced as byte

.         
.         /* Convert categorical strings into categorical numerics */
.         local cat_str_list sale_location sale_crop sale_unit

.         tab1 `cat_str_list', missing

-> tabulation of sale_location  

              sale location |      Freq.     Percent        Cum.
----------------------------+-----------------------------------
New Carlisle Farmers Market |        165       94.29       94.29
The Brosey Farm: farm stand |         10        5.71      100.00
----------------------------+-----------------------------------
                      Total |        175      100.00

-> tabulation of sale_crop  

                    sale crop |      Freq.     Percent        Cum.
------------------------------+-----------------------------------
                              |         10        5.71        5.71
          bean- fin de bagnol |          3        1.71        7.43
              carrot- touchon |         14        8.00       15.43
                     cilantro |          4        2.29       17.71
       eggplant- black beauty |         15        8.57       26.29
              pepper- anaheim |         10        5.71       32.00
               pepper- ghost  |          1        0.57       32.57
             pepper- habanero |          1        0.57       33.14
      pepper- jalapeno- early |         24       13.71       46.86
         pepper- sweet banana |         14        8.00       54.86
     pepper- sweet- ca wonder |         22       12.57       67.43
            pumpkin- ct field |          2        1.14       68.57
sweet corn- country gentleman |          3        1.71       70.29
                tomato- amish |         36       20.57       90.86
                 tomato- roma |         16        9.14      100.00
------------------------------+-----------------------------------
                        Total |        175      100.00

-> tabulation of sale_unit  

sale amount |
       unit |      Freq.     Percent        Cum.
------------+-----------------------------------
            |         10        5.71        5.71
      bunch |          4        2.29        8.00
      pound |         50       28.57       36.57
       unit |        111       63.43      100.00
------------+-----------------------------------
      Total |        175      100.00

.         foreach var of varlist `cat_str_list' {
  2.                 if `var'=="." continue
  3.                 encode (`var'), generate(`var'_code)
  4.                 tablist `var' `var'_code, sort(variable) ab(32)
  5.                 tablist `var' `var'_code, sort(variable) nolabel ab(32)
  6.                 local varlab : variable label `var'
  7.                 label variable `var'_code "`varlab'- code"
  8.                 order `var'_code, after(`var')
  9.                 *pause
.         }

  +-------------------------------------------------------------------------------------------------+
  |               sale_location            sale_location_code   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |-------------------------------------------------------------------------------------------------|
  | New Carlisle Farmers Market   New Carlisle Farmers Market      165    94.29       165     94.29 |
  | The Brosey Farm: farm stand   The Brosey Farm: farm stand       10     5.71       175    100.00 |
  +-------------------------------------------------------------------------------------------------+

  +----------------------------------------------------------------------------------------+
  |               sale_location   sale_location_code   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |----------------------------------------------------------------------------------------|
  | New Carlisle Farmers Market                    1      165    94.29       165     94.29 |
  | The Brosey Farm: farm stand                    2       10     5.71       175    100.00 |
  +----------------------------------------------------------------------------------------+

  +-----------------------------------------------------------------------------------------------------+
  |                     sale_crop                  sale_crop_code   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |-----------------------------------------------------------------------------------------------------|
  |                 tomato- amish                   tomato- amish       36    20.57        36     20.57 |
  |       pepper- jalapeno- early         pepper- jalapeno- early       24    13.71        60     34.29 |
  |      pepper- sweet- ca wonder        pepper- sweet- ca wonder       22    12.57        82     46.86 |
  |                  tomato- roma                    tomato- roma       16     9.14        98     56.00 |
  |        eggplant- black beauty          eggplant- black beauty       15     8.57       113     64.57 |
  |-----------------------------------------------------------------------------------------------------|
  |          pepper- sweet banana            pepper- sweet banana       14     8.00       127     72.57 |
  |               carrot- touchon                 carrot- touchon       14     8.00       141     80.57 |
  |                                                             .       10     5.71       151     86.29 |
  |               pepper- anaheim                 pepper- anaheim       10     5.71       161     92.00 |
  |                      cilantro                        cilantro        4     2.29       165     94.29 |
  |-----------------------------------------------------------------------------------------------------|
  |           bean- fin de bagnol             bean- fin de bagnol        3     1.71       168     96.00 |
  | sweet corn- country gentleman   sweet corn- country gentleman        3     1.71       171     97.71 |
  |             pumpkin- ct field               pumpkin- ct field        2     1.14       173     98.86 |
  |                pepper- ghost                    pepper- ghost        1     0.57       174     99.43 |
  |              pepper- habanero                pepper- habanero        1     0.57       175    100.00 |
  +-----------------------------------------------------------------------------------------------------+

  +--------------------------------------------------------------------------------------+
  |                     sale_crop   sale_crop_code   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |--------------------------------------------------------------------------------------|
  |                 tomato- amish               13       36    20.57        36     20.57 |
  |       pepper- jalapeno- early                8       24    13.71        60     34.29 |
  |      pepper- sweet- ca wonder               10       22    12.57        82     46.86 |
  |                  tomato- roma               14       16     9.14        98     56.00 |
  |        eggplant- black beauty                4       15     8.57       113     64.57 |
  |--------------------------------------------------------------------------------------|
  |               carrot- touchon                2       14     8.00       127     72.57 |
  |          pepper- sweet banana                9       14     8.00       141     80.57 |
  |                                              .       10     5.71       151     86.29 |
  |               pepper- anaheim                5       10     5.71       161     92.00 |
  |                      cilantro                3        4     2.29       165     94.29 |
  |--------------------------------------------------------------------------------------|
  |           bean- fin de bagnol                1        3     1.71       168     96.00 |
  | sweet corn- country gentleman               12        3     1.71       171     97.71 |
  |             pumpkin- ct field               11        2     1.14       173     98.86 |
  |                pepper- ghost                 6        1     0.57       174     99.43 |
  |              pepper- habanero                7        1     0.57       175    100.00 |
  +--------------------------------------------------------------------------------------+

  +------------------------------------------------------------------+
  | sale_unit   sale_unit_code   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |------------------------------------------------------------------|
  |      unit             unit      111    63.43       111     63.43 |
  |     pound            pound       50    28.57       161     92.00 |
  |                          .       10     5.71       171     97.71 |
  |     bunch            bunch        4     2.29       175    100.00 |
  +------------------------------------------------------------------+

  +------------------------------------------------------------------+
  | sale_unit   sale_unit_code   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |------------------------------------------------------------------|
  |      unit                3      111    63.43       111     63.43 |
  |     pound                2       50    28.57       161     92.00 |
  |                          .       10     5.71       171     97.71 |
  |     bunch                1        4     2.29       175    100.00 |
  +------------------------------------------------------------------+

. 
.     
. *=========================================================================================
. * III) CLEAN DATA
. *=========================================================================================     
. 
.         /* Clean missing values */
.         foreach var of varlist sale_location_stall_no sale_crop sale_crop_code sale_amnt sale_unit sale_unit_code {
  2.                 capture confirm numeric variable `var'
  3.                 if _rc==0 {
  4.                         assert `var'==. if sale_location== "The Brosey Farm: farm stand"
  5.                         replace `var'=.s if sale_location== "The Brosey Farm: farm stand"
  6.                 }               
  7.                 else {
  8.                         assert `var'=="" if sale_location== "The Brosey Farm: farm stand"
  9.                         replace `var'=".s" if sale_location== "The Brosey Farm: farm stand"                     
 10.                 }
 11.         }
(10 real changes made, 10 to missing)
(10 real changes made)
(10 real changes made, 10 to missing)
(10 real changes made, 10 to missing)
(10 real changes made)
(10 real changes made, 10 to missing)

.         
.         tablist sale_location sale_location_stall_no sale_location_stall_spec, sort(variable) ab(32)

  +-----------------------------------------------------------------------------------------------------------------------+
  |               sale_location   sale_location_stall_no   sale_location_stall_spec   _Freq_   _Perc_   _CFreq_   _CPerc_ |
  |-----------------------------------------------------------------------------------------------------------------------|
  | New Carlisle Farmers Market                        5             outside, north       83    47.43        83     47.43 |
  | New Carlisle Farmers Market                        4             outside, north       26    14.86       109     62.29 |
  | New Carlisle Farmers Market                        .              outside, east       26    14.86       135     77.14 |
  | New Carlisle Farmers Market                        8             outside, north       18    10.29       153     87.43 |
  | New Carlisle Farmers Market                        6             outside, north       12     6.86       165     94.29 |
  |-----------------------------------------------------------------------------------------------------------------------|
  | The Brosey Farm: farm stand                       .s                   roadside       10     5.71       175    100.00 |
  +-----------------------------------------------------------------------------------------------------------------------+

.         replace sale_location_stall_no= .m if sale_location_stall_no==.
(26 real changes made, 26 to missing)

.         replace sale_location_stall_spec= ".m" if sale_location_stall_spec==""
(0 real changes made)

.         
.         foreach var of varlist _all {
  2.                 tabulate `var', missing
  3.                 capture confirm numeric variable `var'
  4.                 if _rc==0 assert `var' !=.
  5.                 else assert `var' !=""
  6.         }       

  sale date |      Freq.     Percent        Cum.
------------+-----------------------------------
 2023-08-05 |         26       14.86       14.86
 2023-08-12 |         18       10.29       25.14
 2023-08-19 |         41       23.43       48.57
 2023-08-26 |         24       13.71       62.29
 2023-08-30 |          1        0.57       62.86
 2023-09-02 |         29       16.57       79.43
 2023-09-07 |          1        0.57       80.00
 2023-09-08 |          1        0.57       80.57
 2023-09-13 |          1        0.57       81.14
 2023-09-14 |          1        0.57       81.71
 2023-09-23 |         12        6.86       88.57
 2023-09-30 |         15        8.57       97.14
 2023-10-03 |          1        0.57       97.71
 2023-10-04 |          2        1.14       98.86
 2023-10-09 |          1        0.57       99.43
 2023-10-11 |          1        0.57      100.00
------------+-----------------------------------
      Total |        175      100.00

 sale date- |
      stata |      Freq.     Percent        Cum.
------------+-----------------------------------
  05aug2023 |         26       14.86       14.86
  12aug2023 |         18       10.29       25.14
  19aug2023 |         41       23.43       48.57
  26aug2023 |         24       13.71       62.29
  30aug2023 |          1        0.57       62.86
  02sep2023 |         29       16.57       79.43
  07sep2023 |          1        0.57       80.00
  08sep2023 |          1        0.57       80.57
  13sep2023 |          1        0.57       81.14
  14sep2023 |          1        0.57       81.71
  23sep2023 |         12        6.86       88.57
  30sep2023 |         15        8.57       97.14
  03oct2023 |          1        0.57       97.71
  04oct2023 |          2        1.14       98.86
  09oct2023 |          1        0.57       99.43
  11oct2023 |          1        0.57      100.00
------------+-----------------------------------
      Total |        175      100.00

              sale location |      Freq.     Percent        Cum.
----------------------------+-----------------------------------
New Carlisle Farmers Market |        165       94.29       94.29
The Brosey Farm: farm stand |         10        5.71      100.00
----------------------------+-----------------------------------
                      Total |        175      100.00

        sale location- code |      Freq.     Percent        Cum.
----------------------------+-----------------------------------
New Carlisle Farmers Market |        165       94.29       94.29
The Brosey Farm: farm stand |         10        5.71      100.00
----------------------------+-----------------------------------
                      Total |        175      100.00

sale_locati |
on_stall_no |      Freq.     Percent        Cum.
------------+-----------------------------------
          4 |         26       14.86       14.86
          5 |         83       47.43       62.29
          6 |         12        6.86       69.14
          8 |         18       10.29       79.43
         .m |         26       14.86       94.29
         .s |         10        5.71      100.00
------------+-----------------------------------
      Total |        175      100.00

sale_location_ |
    stall_spec |      Freq.     Percent        Cum.
---------------+-----------------------------------
 outside, east |         26       14.86       14.86
outside, north |        139       79.43       94.29
      roadside |         10        5.71      100.00
---------------+-----------------------------------
         Total |        175      100.00

                    sale crop |      Freq.     Percent        Cum.
------------------------------+-----------------------------------
                           .s |         10        5.71        5.71
          bean- fin de bagnol |          3        1.71        7.43
              carrot- touchon |         14        8.00       15.43
                     cilantro |          4        2.29       17.71
       eggplant- black beauty |         15        8.57       26.29
              pepper- anaheim |         10        5.71       32.00
               pepper- ghost  |          1        0.57       32.57
             pepper- habanero |          1        0.57       33.14
      pepper- jalapeno- early |         24       13.71       46.86
         pepper- sweet banana |         14        8.00       54.86
     pepper- sweet- ca wonder |         22       12.57       67.43
            pumpkin- ct field |          2        1.14       68.57
sweet corn- country gentleman |          3        1.71       70.29
                tomato- amish |         36       20.57       90.86
                 tomato- roma |         16        9.14      100.00
------------------------------+-----------------------------------
                        Total |        175      100.00

              sale crop- code |      Freq.     Percent        Cum.
------------------------------+-----------------------------------
          bean- fin de bagnol |          3        1.71        1.71
              carrot- touchon |         14        8.00        9.71
                     cilantro |          4        2.29       12.00
       eggplant- black beauty |         15        8.57       20.57
              pepper- anaheim |         10        5.71       26.29
               pepper- ghost  |          1        0.57       26.86
             pepper- habanero |          1        0.57       27.43
      pepper- jalapeno- early |         24       13.71       41.14
         pepper- sweet banana |         14        8.00       49.14
     pepper- sweet- ca wonder |         22       12.57       61.71
            pumpkin- ct field |          2        1.14       62.86
sweet corn- country gentleman |          3        1.71       64.57
                tomato- amish |         36       20.57       85.14
                 tomato- roma |         16        9.14       94.29
                           .s |         10        5.71      100.00
------------------------------+-----------------------------------
                        Total |        175      100.00

sale amount |      Freq.     Percent        Cum.
------------+-----------------------------------
         .5 |          7        4.00        4.00
        .75 |          2        1.14        5.14
          1 |         50       28.57       33.71
        1.5 |          3        1.71       35.43
          2 |         30       17.14       52.57
        2.5 |          2        1.14       53.71
          3 |         14        8.00       61.71
        3.5 |          1        0.57       62.29
          4 |         17        9.71       72.00
          5 |         16        9.14       81.14
          6 |          6        3.43       84.57
          7 |          3        1.71       86.29
          8 |          4        2.29       88.57
          9 |          2        1.14       89.71
         10 |          3        1.71       91.43
         11 |          1        0.57       92.00
         12 |          1        0.57       92.57
         20 |          1        0.57       93.14
         28 |          1        0.57       93.71
         55 |          1        0.57       94.29
         .s |         10        5.71      100.00
------------+-----------------------------------
      Total |        175      100.00

sale amount |
       unit |      Freq.     Percent        Cum.
------------+-----------------------------------
         .s |         10        5.71        5.71
      bunch |          4        2.29        8.00
      pound |         50       28.57       36.57
       unit |        111       63.43      100.00
------------+-----------------------------------
      Total |        175      100.00

sale amount |
 unit- code |      Freq.     Percent        Cum.
------------+-----------------------------------
      bunch |          4        2.29        2.29
      pound |         50       28.57       30.86
       unit |        111       63.43       94.29
         .s |         10        5.71      100.00
------------+-----------------------------------
      Total |        175      100.00

 sale value |
  (dollars) |      Freq.     Percent        Cum.
------------+-----------------------------------
         .5 |          6        3.43        3.43
          1 |         76       43.43       46.86
          2 |         46       26.29       73.14
          3 |         18       10.29       83.43
          4 |          8        4.57       88.00
          5 |          6        3.43       91.43
          6 |          2        1.14       92.57
          7 |          2        1.14       93.71
          9 |          2        1.14       94.86
         10 |          3        1.71       96.57
         12 |          1        0.57       97.14
         13 |          1        0.57       97.71
         19 |          1        0.57       98.29
         20 |          1        0.57       98.86
         40 |          1        0.57       99.43
         57 |          1        0.57      100.00
------------+-----------------------------------
      Total |        175      100.00

.                 
.         /* Save clean TBF Market Garden 2023 data */
.         quietly compress

.         save "$root\modified_data\tbf_market_garden_sales_2023_clean.dta", replace
file C:\Users\sethb\Documents\The Brosey Farm\GitHub repositories\The-Brosey-Farm\analytics\modified_data\tbf_market_garden_sales_2023_clean.dta saved

.         
.  
. *=========================================================================================
. * IV) DESCRIPTIVE STATISTICS
. *=========================================================================================     
.         
.         describe _all

Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
sale_date       str10   %10s                  sale date
sale_date_stata int     %td                   sale date- stata
sale_location   str27   %27s                  sale location
sale_location~e byte    %27.0g     sale_location_code
                                              sale location- code
sale_location~o byte    %10.0g                sale_location_stall_no
sale_location~c str14   %14s                  sale_location_stall_spec
sale_crop       str29   %29s                  sale crop
sale_crop_code  byte    %29.0g     sale_crop_code
                                              sale crop- code
sale_amnt       double  %10.0g                sale amount
sale_unit       str5    %9s                   sale amount unit
sale_unit_code  byte    %8.0g      sale_unit_code
                                              sale amount unit- code
sale_value_usd  double  %10.0g                sale value (dollars)

. 
. 
. log close _all
      name:  clean_01
       log:  C:\Users\sethb\Documents\The Brosey Farm\GitHub repositories\The-Brosey-Farm\analytics\Stata_programs\03_tbf_sales_2023_cleaning.log
  log type:  text
 closed on:  12 Oct 2023, 23:28:26
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
